<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
  <title></title>
<meta name="generator" content="sitegen" />
<meta property="og:title" content="blog" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The personal website of David Minnix. David is an artist, software engineer, and musician who makes noise and tools for making noise." />
<meta property="og:description" content="The personal website of David Minnix. David is an artist, software engineer, and musician who makes noise and tools for making noise." />
<meta property="og:site_name" content="xinniw.net" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="blog" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","dateModified":"06/03/2024","description":"The personal website of David Minnix. David is an artist, software engineer, and musician who makes noise and tools for making noise.","headline":"blog","name":"xinniw.net","url":"<?phpecho $page->path?>"}</script>
<!-- End Jekyll SEO tag -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link rel="stylesheet" href="/assets/css/style.css?v=">
  <link href="/assets/css/prism.css" rel="stylesheet" /><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="xinniw" />  <!--[if lt IE 9]>

    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
  <![endif]-->
</head>
<body>
    <header class="site-header">
<div class="wrapper">
    <a class="site-title" rel="author" href="/">xinniw</a>
    <nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="-1 0 18 15" width="18px" height="15px">
                <path d="M17,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>

          <div class="trigger">

    <a class="page-link" href="/listen">/listen</a>

    
    <a class="page-link" href="/downloads">/downloads</a>

    
    <a class="page-link" href="/garden">/garden</a>

    
    <a class="page-link" href="/shows">/shows</a>

    
    <a class="page-link" href="/projects">/projects</a>

    
    <a class="page-link" href="/about">/about</a>

              </div>
    </nav>
</div>


  </header>

    <p class="bg" ></p>
    <main class="page-content" aria-label="Content">
    <div class="background-div--effect">




<div class="insert--div-tidalcode">

<code class="language-haskell insert--code-tidalcode">
    d4
-- $ rev \n
$ note
((scaleP scalePattern
  -- $ off 4 ((+ 2 ).slow 2) \n
  -- $ off 1 (inversion.slow 2) \n
  $(rotR 1.5 )
  $(+ slow 8 "x" <~> generateMelodicSeed)
  -- $ inversion \n
  $ generateMelodicSeed
))#s "[pe-gtr:12,midi]" #gain 1.2 #orbit 3 #midichan 4
</code>
<code class="language-haskell insert--code-tidalcode">
    d1
$ note
((scaleP scalePattern
  $ off 4 ((+ 2 ).slow 2)
  $ off 1 (inversion.slow 2)
  $ off 3 (inversion.slow 3)
  $ off 1.5 ((+ 2).rev.slow 2)
  $ generateMelodicSeed
))#s "[pe-gtr:10,midi]" #gain 1 #orbit 0 #midichan 1</code>
<code class="language-haskell insert--code-tidalcode">
    do
cps (86/60/2)
d9 $ midicmd "midiClock*48" # s "midi"</code>
<code class="language-haskell insert--code-tidalcode">
    let melody = slow 6 $ "0 2 [4 8 .] [3 4 3] 8 4 9"</code>
<!-- {% for snippet in snippets ?> -->
<!-- {% endfor ?> -->

</div>

      </div>
<div class="wrapper">
<!DOCTYPE html>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<html>
<head>
<title>/home/xinniw/Documents/garden/numerically controlled
oscillator.md</title>
<link rel="stylesheet" href="style.css">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<meta http-equiv="Content-Type" content="text/html">
</head>
<body>
<div>
    <a href="index.html">index</a> > /home/xinniw/Documents/garden/numerically
controlled oscillator.md
    </div>
<hr />
<h1 id="numerically-controlled-oscillator">Numerically Controlled
Oscillator</h1>
<p>A numerically controlled oscillator is a simple algorithm for
computing the changing phase of an oscillator over time. It can be used
to make all kinds of waveforms and is often at the heart of more
complicated synthesis algorithms. (see: <a href="FM%20Synthesis.html">FM
Synthesis</a>)</p>
<p>So how does it work? To make an NCO we keep some state for tracking
the phase of the oscillator. We then convert the desired frequency into
a phase increment. The phase increment is the amount that we add to the
phase every sample.</p>
<p>The formula for the phase increment:</p>
<p>$ inc = 2\pi\frac{f}{f_{sr}} $ (where <span
class="math inline">\(f\)</span> is the frequency and <span
class="math inline">\(f_{sr}\)</span> is the sample rate)</p>
<p>For each sample we compute the output value using the phase and then
increment the phase. The following pseudo-code would make a sine wave
oscillator:</p>
<pre><code>struct SinOsc{
    float phase;
    void update_phase(float freq, float samplerate){
        float inc = 2*PI*freq/samplerate;
        phase+= inc;
        if(phase&gt;2*PI) phase -= 2*PI;
        return next_phase;
    }
    float process(float freq, float samplerate){
        float next_sample = sin(phase);
        update_phase(freq, samplerate);
        return next_sample;
    }
}

</code></pre>
<p>In reality, computing the value of the increment every sample may be
unnecessary and a separate <code>setFrequency</code> method could be
made to make the process more efficient.</p>
<p>But isn't a sine wave just a pure math function? Why do we have to
keep track of the phase state? Couldn't we just write something like the
following?</p>
<pre><code>    float inc = 2*PI*freq/samplerate;
    float sample = sin(sample_number*inc);</code></pre>
<p>The above would be purely functional and most of the time at the top
of our code we are iterating through sample indexes as we fill a buffer
of output samples. The problem is with truncation error. As we multiply
large floating point numbers, we lose information as we only have a
limited number of bits to represent any floating point number. The
result is an oscillator that rapidly goes out of tune and distorts.
(fixed point numbers also have problems)</p>
<p>We could make our oscillator design more referentially transparent
however.</p>
<pre><code>float update_phase(float phase, float increment, float period = TWO_PI){
    float next_phase = phase+increment;
    if(next_phase&gt;period) next_phase -= period;
    return next_phase;
}

struct sin_osc_t {
    float phase;
    float increment;
    float output;
}

sin_osc_t process(sint_osc_t state){
    sin_osc_t next_state = state;
    next_state.output = sin(state.phase);
    next_state.phase = update_phase(state.phase, state.increment);
    
    return next_state;
}

</code></pre>
<p>In the algorithm above we avoid mutating any state values. Its purely
functional. We can do all of our mutation in one layer of the code and
treat the rest as pure functions. This has benefits for testing,
multi-threading, and organizing complex algorithms. It, however, may be
less efficient as we will copy more data. (each function call returns a
copy of its input data and leaves the original intact)</p>
<p>I'm curious of the limits of the above technique in a language like
<code>C++</code> where code is not lazily evaluated and most data types
are not specialized for pure functional use. (eg. Haskell Lists) This
could potentially limit the performance in a way that is unacceptable
for many applications. However, most modern compilers make aggressive
optimizations and many data copy operations could be eliminated by
inlining the code.</p>
<h1 id="todo">TODO</h1>
<p>Compile both algorithms and compare the generated assembly to see
what optimizations were made. Then compare the performance.</p>
<hr />
<div>
    <a href="index.html">index</a> > /home/xinniw/Documents/garden/numerically
controlled oscillator.md
      </ol>
    </div>
	</div>
</body>
</html>
</div>

    <footer class="site-footer h-card">
<data class="u-url" href="garden/numerically controlled oscillator.html"></data>

  <div class="wrapper">

    <!-- <h2 class="footer-heading">xinniw</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">xinniw</li><li class="li--a-webring"><a href='https://webring.xxiivv.com/#random' target='_blank'><img src='https://webring.xxiivv.com/icon.black.svg'/></a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a rel="me" href="https://post.lurk.org/@xinniw"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#mastodon"></use></svg> <span class="username">xinniw</span></a></li><li><a href=""><img class="svg-icon" src="/assets/images/Spotify_Icon_CMYK_Black.png"/> <span class="username">xinniw</span></a></li><li><a href="https://www.youtube.com/channel/UCV75fqpnnjCmM0I7Fogf53w"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#youtube"></use></svg><span class="username">YouTube</span></a></li><li><a href="/feed.xml"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>xinniw feed</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>ambient, techno, future music</p>
        <p class="footer--p-credit">photography by gary minnix</p>
      </div>
    </div>

  </div>

</footer>

  </main>
</body>
</html>
